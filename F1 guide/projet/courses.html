<!doctype html>
<html lang="fr">
    <head>   <!-- Définition d'informations qui ne s'affichent pas sur la page -->
        <meta charset="utf-8" /> <!-- Conventions d'écriture pour assurer un affichage correct des caractères spéciaux -->
        <link rel="stylesheet" href="../style/style.css" /> <!-- Lien avec la feuille de style en CSS -->
        <title>F1 guide</title> <!-- Titre de l'onglet -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"> <!-- Configuration du bootstrap -->

        <!-- Configuration du favicon avec une compatibilité maximale -->
        <link rel="apple-touch-icon" sizes="180x180" href="../images/favicon/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="../images/favicon/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="../images/favicon/favicon-16x16.png">
        <link rel="manifest" href="../images/favicon/site.webmanifest">

        <!-- f) -->
        <style>
        .icone{
            position: absolute;
            width: 2rem;
            }
        </style>

    </head>
    <body> <!-- Corps de la page (contenu visible)-->

        <section class="hero-image"> <!-- Image d'accueil -->
            <a style="color : white; text-decoration: none; font-size: xx-large; font-weight: bold;" href="#header">Start</a>
        </section>

        <main> <!-- Partie principale avec tout le reste du contenu -->
            <header class="main-header" id="header"> <!-- En-tête principal -->
                <nav>
                    <img src="../images/F1_logo_sans_fond.png" alt="F1 Logo" class="header-logo">
                    <ul>
                        <li><a href="travail_projet.html#header">Classements</a></li>
                        <li><a class="active" href="#header">Courses</a></li>
                        <li><a href="circuits.html#header">Circuits</a></li>
                        <li><a href="pilotes.html#header">Pilotes</a></li>
                        <li><a href="#contact">Contact</a></li>
                    </ul>
                </nav>
            </header>

            <section id="courses">
                <select id="select-saison" name="saison"></select>
                <select id="select-course" name="course"></select>

                <!-- c) -->
                <img src="https://imgs.search.brave.com/lrpJwswu-0B3aNMkP3u3Pq-YXgLS0dm3hFtG3tlAyMI/rs:fit:500:0:1:0/g:ce/aHR0cHM6Ly9zdGF0/aWMudmVjdGVlenku/Y29tL3N5c3RlbS9y/ZXNvdXJjZXMvdGh1/bWJuYWlscy8wNTUv/MDY2LzA5Ni9zbWFs/bC9yZWN0YW5ndWxh/ci1ibGFjay1hbmQt/d2hpdGUtc3F1YXJl/cy1jaGVja2VyYm9h/cmQtcGF0dGVybi1y/YWNpbmctZmxhZy1p/Y29uLWZyZWUtcG5n/LnBuZw" alt="Drapeau damier" class="icone">

                <div class="tab-container">
                    <div class="table-responsive"> <!-- Classe qui référence le bootstrap -->
                        <h2>Résultats course</h2>
                        <table class="table table-dark table-striped table-hover table-rounded"> <!-- Classe qui référence le bootstrap -->
                            <caption>Résultats course</caption>
                            <thead>
                                <tr>
                                    <th>Position</th>
                                    <th>Pilote</th>
                                    <th>Écurie</th>
                                    <th>Temps</th>
                                    <th>Position de départ</th>
                                    <th>Points</th>
                                </tr>
                            </thead>
                            <tbody id="classement-course">
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </main>

        <footer id="contact">
            <p>
                &copy; 2025 F1 Guide. Tous droits réservés. <a href="../CV_Joaquim_DAUBAGNA--LEFEBVRE.pdf" target="_blank">Lien vers mon CV →</a>
            </p>
        </footer>
    </body>






    
    <script>

        // --- Variables globales ---
        const anneeSelect = document.getElementById("select-saison"); 
        const courseSelect = document.getElementById("select-course"); 
        const anneeCourante = new Date().getFullYear();
        let coursesActuelles = [];

        // --- 1. Créer les options d'années (de 1950 à maintenant) ---
        for (let annee = anneeCourante; annee >= 1950; annee--) {
            const option = document.createElement("option");
            option.value = annee;
            option.textContent = annee;
            anneeSelect.appendChild(option);
        }

        // --- 2. Fonction pour charger les courses d'une année ---
        function chargerCourses(annee) {
            const url = `https://corsproxy.io/?https://api.jolpi.ca/ergast/f1/${annee}/races`;
            
            courseSelect.disabled = true;
            
            fetch(url)
                .then(response => response.json())
                .then(data => {  
                    courseSelect.innerHTML = '';                  
                    coursesActuelles = data.MRData.RaceTable.Races;
                    
                    coursesActuelles.forEach((course, index) => {
                        const option = document.createElement("option");
                        option.value = course.round;
                        option.dataset.index = index;
                        
                        const date = new Date(course.date);
                        const dateFormatee = date.toLocaleDateString('fr-FR', { 
                            day: 'numeric', 
                            month: 'short' 
                        });
                        
                        option.textContent = `Round ${course.round} - ${course.raceName} (${dateFormatee})`;
                        courseSelect.appendChild(option);
                    });
                    
                    courseSelect.disabled = false;
                    
                    // Sélectionner automatiquement le Round 1 et afficher ses résultats
                    if (coursesActuelles.length > 0) {
                        courseSelect.value = coursesActuelles[0].round;
                        afficherClassementCourse(coursesActuelles[0].round);
                    }
                })
                .catch(error => {
                    console.error('Erreur:', error);
                    courseSelect.innerHTML = '<option value="">Erreur de chargement</option>';
                    afficherErreur('Impossible de charger les courses');
                });
        }

        // --- 3. Fonction pour afficher le classement d'une course ---
        function afficherClassementCourse(round) {
            const annee = anneeSelect.value;
            const url = `https://corsproxy.io/?https://api.jolpi.ca/ergast/f1/${annee}/${round}/results`;
            
            const tbody = document.getElementById('classement-course');
            tbody.innerHTML = '<tr><td colspan="5" class="no-data">Chargement des résultats...</td></tr>';
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const race = data.MRData.RaceTable.Races[0];
                    
                    // Cas où la course n'a pas encore eu lieu
                    if (!race || !race.Results || race.Results.length === 0) {
                        const tbody = document.getElementById('classement-course');
                        tbody.innerHTML = `<tr><td colspan="5" class="no-data"> Aucun résultat disponible pour cette course </td></tr>`;
                        return;
                    }
                    
                    tbody.innerHTML = '';
                    
                    race.Results.forEach(resultat => {
                        const ligne = tbody.insertRow();
                        
                        // Position
                        const cellPosition = ligne.insertCell();
                        cellPosition.textContent = resultat.position;
                        cellPosition.className = 'position-cell';
                        
                        // Pilote
                        const nomComplet = `${resultat.Driver.givenName} ${resultat.Driver.familyName}`;
                        ligne.insertCell().textContent = nomComplet;
                        
                        // Écurie
                        ligne.insertCell().textContent = resultat.Constructor.name;
                        
                        // Temps ou statut
                        let tempsAffiche = resultat.status;
                        if (resultat.Time) {
                            tempsAffiche = resultat.Time.time;
                        } else if (resultat.status === 'Finished') {
                            tempsAffiche = `+${resultat.laps} tours`;
                        }
                        ligne.insertCell().textContent = tempsAffiche;

                        // Position de départ
                        ligne.insertCell().textContent = resultat.grid;
                        
                        // Points
                        ligne.insertCell().textContent = resultat.points;
                    });
                })
                .catch(error => {
                    console.error('Erreur:', error);
                    afficherErreur('Impossible de charger les résultats de la course');
                });
        }

        // --- 4. Fonction qui affiche un message en cas d'erreur ---
        function afficherErreur(message) {
            const tbody = document.getElementById('classement-course');
            tbody.innerHTML = `<tr><td colspan="5" class="no-data" style="color: #e10600;">${message}</td></tr>`;
        }

        // --- 5. Écouteurs d'événements ---
        anneeSelect.addEventListener('change', function() {
                chargerCourses(this.value);
        });

        courseSelect.addEventListener('change', function() {
                afficherClassementCourse(this.value);
        });

        // --- 6. Initialisation ---
        // Charger automatiquement l'année en cours au démarrage
        window.addEventListener('load', function() {
            anneeSelect.value = anneeCourante;
            chargerCourses(anneeCourante);
        });
    </script>
</html> 